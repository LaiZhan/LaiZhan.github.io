import{_ as V,c as d,a as n,b as P,t as u,F as C,d as g,r as p,o as i,e as q,w as b,f as v,g as I,h as M,i as G,n as H,j as x,k as O}from"./index-SdsKWKXs.js";const J=["零食广场","饼干","膨化薯片"],K=[{id:1,name:"哇哈哈",price:35.91,image:"/goods/2.png",category:"零食广场"},{id:2,name:"饼干",price:35.91,image:"/goods/3.png",category:"饼干"},{id:3,name:"膨化薯片",price:35.91,image:"/goods/4.jpg",category:"膨化薯片"},{id:4,name:"哇哈哈",price:35.91,image:"/goods/5.png",category:"零食广场"},{id:5,name:"哇哈哈",price:35.91,image:"/goods/6.png",category:"零食广场"},{id:6,name:"哇哈哈",price:35.91,image:"/goods/7.png",category:"膨化薯片"},{id:7,name:"哇哈哈",price:35.91,image:"/goods/8.jpg",category:"零食广场"},{id:8,name:"哇哈哈",price:35.91,image:"/goods/9.png",category:"零食广场"},{id:9,name:"哇哈哈",price:35.91,image:"/goods/10.png",category:"零食广场"}],R=[],y={categories:J,products:K,cart:R},W=()=>{y.cart||(y.cart=[]),y.products&&y.products.forEach(s=>{s.quantity===void 0&&(s.quantity=0)})};W();const X=()=>new Promise(s=>{setTimeout(()=>{s(y.categories||[])},200)}),Y=()=>new Promise(s=>{setTimeout(()=>{const t=y.products.map(c=>({...c,quantity:c.quantity||0}));s(t)},200)}),Z=()=>new Promise(s=>{setTimeout(()=>{s({cart:y.cart||[],totalPrice:(y.cart||[]).reduce((t,c)=>t+c.price*(c.quantity||0),0)})},200)}),F=()=>new Promise(s=>{setTimeout(()=>{y.cart=[],s()},200)}),$={name:"ProductCard",props:{product:{type:Object,required:!0}},mounted(){this.product&&this.product.quantity===void 0&&(this.product.quantity=0)}},tt={class:"product-card"},et={class:"product-image"},ot=["src","alt"],nt={class:"product-content"},at={class:"product-name"},rt={class:"product-price-row"},st={class:"product-price"},ct={class:"price-value"},it={class:"product-actions"},dt={class:"quantity"};function lt(s,t,c,o,l,Q){const h=p("van-icon");return i(),d("div",tt,[n("div",et,[n("img",{src:c.product.image,alt:c.product.name},null,8,ot)]),n("div",nt,[P("",!0),n("div",at,u(c.product.name),1),P("",!0),P("",!0),n("div",rt,[n("div",st,[t[4]||(t[4]=n("span",{class:"price-symbol"},"¥",-1)),n("span",ct,u(c.product.price),1)]),n("div",it,[c.product.quantity>0?(i(),d(C,{key:0},[n("button",{class:"quantity-btn decrease",onClick:t[0]||(t[0]=m=>s.$emit("decrease-quantity",c.product))},"-"),n("span",dt,u(c.product.quantity),1),n("button",{class:"quantity-btn increase",onClick:t[1]||(t[1]=m=>s.$emit("increase-quantity",c.product))},"+")],64)):(i(),d("button",{key:1,class:"add-btn",onClick:t[2]||(t[2]=m=>s.$emit("add-to-cart",c.product))},[g(h,{name:"plus"})]))])])])])}const ut=V($,[["render",lt],["__scopeId","data-v-b4064652"]]),yt={name:"ProductSelectionPage",components:{ProductCard:ut},setup(){const s=v(""),t=v(0),c=v([]),o=v([]),l=v([]),Q=v(!1),h=v(!1),m=v(!0),_=I(()=>{if(!s.value)return c.value;const e=new Set(o.value.filter(r=>r.name.includes(s.value)).map(r=>r.category));return c.value.filter(r=>e.has(r))}),w=I(()=>{if(_.value.length===0)return[];const e=_.value[t.value];return o.value.filter(r=>{const L=r.category===e,U=!s.value||r.name.includes(s.value);return L&&U})}),k=()=>{s.value="",t.value=0};M(_,e=>{e.length>0&&(t.value=0)});const T=async()=>{try{c.value=await X()}catch(e){console.error("获取分类失败:",e),c.value=[]}},S=async()=>{m.value=!0;try{o.value=await Y()}catch(e){console.error("获取商品失败:",e),o.value=[]}finally{m.value=!1}},a=async()=>{try{await F(),l.value=[],o.value.forEach(e=>{e.quantity!==void 0&&(e.quantity=0)}),console.log("购物车已清空")}catch(e){console.error("清空购物车失败:",e)}},f=async()=>{try{const e=await Z();l.value=e.cart}catch(e){console.error("获取购物车失败:",e),l.value=[]}},D=async e=>{try{console.log("添加商品到购物车:",e),e.quantity+=1,l.value.push(e),f()}catch(r){console.error("添加到购物车失败:",r)}},z=e=>{e.quantity+=1},j=e=>{e.quantity>0&&(e.quantity-=1,e.quantity===0&&(l.value=l.value.filter(r=>r.id!==e.id)))},B=async()=>{console.log("结算商品:",l.value),await F(),l.value=[]};G(async()=>{await T(),await S(),await f()});const A=I(()=>l.value.reduce((e,r)=>e+r.price*(r.quantity||0),0)),E=()=>{const e=N();navigator.clipboard.writeText(e).then(()=>{h.value=!1}).catch(r=>{console.error("复制失败:",r)})},N=()=>{let e=`==== 订单信息 ====

`;return l.value.forEach(r=>{e+=`商品ID: ${r.id}
`,e+=`商品名称: ${r.name}
`,e+=`数量: ${r.quantity}
`,e+=`单价: ¥${r.price}
`,e+=`小计: ¥${(r.price*r.quantity).toFixed(2)}

`}),e+=`==== 总计: ¥${A.value.toFixed(2)} ====`,e};return{searchQuery:s,activeCategory:t,categories:c,products:o,cart:l,filteredCategories:_,filteredProducts:w,totalPrice:A,handleAddToCart:D,increaseQuantity:z,decreaseQuantity:j,handleCheckout:B,resetSearch:k,showCart:Q,showOrderSummary:h,isLoading:m,copyOrderInfo:E,handleClearCart:a}}},mt={class:"product-selection"},vt={class:"search-bar"},gt={class:"content"},pt={class:"category-nav"},_t=["onClick"],ht={key:0,class:"category-badge"},ft={key:1},Ct={class:"product-list"},wt={class:"products"},kt={key:0,class:"loading-container"},qt={key:2,class:"empty-product"},bt={class:"cart-bar"},Pt={class:"cart-popup-header"},Qt={class:"cart-popup-actions"},Tt={class:"cart-popup-content"},St={key:0,class:"empty-cart"},It={key:1},xt={class:"order-summary"},Ot={class:"order-item-header"},Dt=["src"],At={class:"order-item-info"},Ft={class:"order-item-name"},Vt={class:"order-item-price"},zt={class:"order-item-footer"},jt={class:"order-total"};function Bt(s,t,c,o,l,Q){const h=p("van-search"),m=p("van-loading"),_=p("ProductCard"),w=p("van-icon"),k=p("van-button"),T=p("van-popup"),S=p("van-dialog");return i(),d("div",mt,[n("div",vt,[g(h,{modelValue:o.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=a=>o.searchQuery=a),placeholder:"搜索商品",shape:"round",onClear:o.resetSearch},null,8,["modelValue","onClear"])]),n("div",gt,[n("div",pt,[(i(!0),d(C,null,q(o.filteredCategories,(a,f)=>(i(),d("div",{key:f,class:H(["category-item",o.activeCategory===f?"active":""]),onClick:D=>o.activeCategory=f},[a==="休闲零食"?(i(),d("span",ht,u(a),1)):(i(),d("span",ft,u(a),1))],10,_t))),128))]),n("div",Ct,[n("div",wt,[o.isLoading?(i(),d("div",kt,[g(m,{type:"spinner",color:"#00b578"}),t[7]||(t[7]=n("p",{class:"loading-text"},"正在加载商品...",-1))])):o.filteredProducts.length>0?(i(!0),d(C,{key:1},q(o.filteredProducts,a=>(i(),x(_,{key:a.id,product:a,onAddToCart:o.handleAddToCart,onIncreaseQuantity:o.increaseQuantity,onDecreaseQuantity:o.decreaseQuantity},null,8,["product","onAddToCart","onIncreaseQuantity","onDecreaseQuantity"]))),128)):(i(),d("div",qt,t[8]||(t[8]=[n("p",null,"暂无商品",-1)])))])])]),n("div",bt,[n("div",{class:"cart-info",onClick:t[1]||(t[1]=a=>o.showCart=!0)},[g(w,{name:"shopping-cart",size:"24"}),n("span",null,"¥"+u(o.totalPrice.toFixed(2)),1)]),g(k,{type:"success",size:"normal",class:"checkout-button",onClick:t[2]||(t[2]=a=>o.showOrderSummary=!0)},{default:b(()=>[O(" 去结算("+u(o.cart.length)+") ",1)]),_:1})]),g(T,{show:o.showCart,"onUpdate:show":t[4]||(t[4]=a=>o.showCart=a),position:"bottom",class:"cart-popup"},{default:b(()=>[n("div",Pt,[t[10]||(t[10]=n("h3",null,"购物车",-1)),n("div",Qt,[o.cart.length>0?(i(),x(k,{key:0,type:"danger",size:"small",plain:"",class:"clear-cart-btn",onClick:o.handleClearCart},{default:b(()=>t[9]||(t[9]=[O(" 清空购物车 ")])),_:1},8,["onClick"])):P("",!0),g(w,{name:"close",size:"20",onClick:t[3]||(t[3]=a=>o.showCart=!1)})])]),n("div",Tt,[o.cart.length===0?(i(),d("div",St,t[11]||(t[11]=[n("p",null,"购物车为空",-1)]))):(i(),d("div",It,[(i(!0),d(C,null,q(o.cart,a=>(i(),x(_,{key:a.id,product:a,onAddToCart:o.handleAddToCart,onIncreaseQuantity:o.increaseQuantity,onDecreaseQuantity:o.decreaseQuantity},null,8,["product","onAddToCart","onIncreaseQuantity","onDecreaseQuantity"]))),128))]))])]),_:1},8,["show"]),g(S,{show:o.showOrderSummary,"onUpdate:show":t[5]||(t[5]=a=>o.showOrderSummary=a),title:"订单详情",onConfirm:o.copyOrderInfo,"confirm-button-text":"确认订单","show-cancel-button":"",onCancel:t[6]||(t[6]=a=>o.showOrderSummary=!1)},{default:b(()=>[n("div",xt,[(i(!0),d(C,null,q(o.cart,a=>(i(),d("div",{key:a.id,class:"order-item"},[n("div",Ot,[n("img",{src:a.image,alt:"商品图片",class:"order-item-image"},null,8,Dt),n("div",At,[n("p",Ft,u(a.name),1),n("p",Vt,"¥"+u(a.price),1)])]),n("div",zt,[n("p",null,"数量: "+u(a.quantity),1),n("p",null,"小计: ¥"+u((a.price*a.quantity).toFixed(2)),1)])]))),128)),n("div",jt,[n("p",null,[t[12]||(t[12]=O("总价: ")),n("span",null,"¥"+u(o.totalPrice.toFixed(2)),1)])])])]),_:1},8,["show","onConfirm"])])}const Nt=V(yt,[["render",Bt]]);export{Nt as default};
